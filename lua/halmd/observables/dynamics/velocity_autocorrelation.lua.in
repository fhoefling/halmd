--
-- Copyright Â© 2012 Peter Colberg
--
-- This file is part of HALMD.
--
-- HALMD is free software: you can redistribute it and/or modify
-- it under the terms of the GNU General Public License as published by
-- the Free Software Foundation, either version 3 of the License, or
-- (at your option) any later version.
--
-- This program is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU General Public License for more details.
--
-- You should have received a copy of the GNU General Public License
-- along with this program.  If not, see <http://www.gnu.org/licenses/>.
--

local module = require("halmd.utility.module")

---
-- Velocity Autocorrelation Function
-- =================================
--

-- grab C++ wrappers
local velocity_autocorrelation = assert(libhalmd.observables.dynamics.velocity_autocorrelation)

---
-- Construct velocity autocorrelation function.
--
-- :param args: keyword arguments
-- :param args.phase_space: instance of :class:`halmd.observables.phase_space`
--
-- .. method:: acquire()
--
--    Acquire phase space sample.
--
--    :returns: phase space sample
--
-- .. method:: correlate(first, second)
--
--    Correlate two phase space samples.
--
--    :param first: first phase space sample
--    :param second: second phase space sample
--    :returns: velocity autocorrelation function between samples
--
-- .. attribute:: group
--
--    H5MD group.
--
-- .. attribute:: desc
--
--    Profiler description.
--
local M = module(function(args)
    local phase_space = args and args.phase_space
    if not phase_space then
        error("missing argument 'phase_space'", 2)
    end
    local acquire = assert(phase_space.acquire())
    local label = assert(phase_space.group.label)

    -- construct instance
    local self = velocity_autocorrelation(acquire)

    -- attach acquire function as read-only property
    self.acquire = property(function(self)
        return acquire
    end)

    -- attach H5MD group
    self.group = property(function(self)
        return {"dynamics", "velocity_autocorrelation", label}
    end)

    -- attach profiler description
    self.desc = property(function(self)
        return ("velocity autocorrelation function of %s"):format(label)
    end)

    return self
end)

return M
